---
name: Repository Health Check

# This workflow validates the basic health and structure of the repository
# It is designed to be transparent and community-friendly
# Community members are encouraged to suggest improvements via
# issues/discussions

'on':
  push:
    branches: [main]
  pull_request:
    branches: [main]
  workflow_dispatch:  # Allows manual triggering for testing

jobs:
  validate-repository:
    name: Validate Repository Structure
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Verify essential files exist
        run: |
          echo "Checking for essential repository files..."

          # Check for required files
          required_files=(
            "README.md"
            "LICENSE"
            "KNOWLEDGE_BASE.md"
            ".github/workflows/main.yml"
          )

          missing_files=()
          for file in "${required_files[@]}"; do
            if [ ! -f "$file" ]; then
              missing_files+=("$file")
              echo "âŒ Missing: $file"
            else
              echo "âœ… Found: $file"
            fi
          done

          if [ ${#missing_files[@]} -ne 0 ]; then
            echo "::error::Missing required files: ${missing_files[*]}"
            exit 1
          fi

          echo "All essential files are present!"

      - name: Verify documentation structure
        run: |
          echo "Checking documentation structure..."

          # Check for important documentation directories
          doc_dirs=(
            "library"
            "issues"
            "bridge"
          )

          for dir in "${doc_dirs[@]}"; do
            if [ -d "$dir" ]; then
              echo "âœ… Found directory: $dir"
              # List contents for transparency
              echo "   Contents:"
              ls -1 "$dir" | sed 's/^/   - /'
            else
              echo "âš ï¸  Missing directory: $dir (optional)"
            fi
          done

      - name: Validate workflow file
        run: |
          echo "Validating workflow file is not empty..."

          if [ ! -s ".github/workflows/main.yml" ]; then
            echo "::error::Workflow file is empty!"
            exit 1
          fi

          echo "âœ… Workflow file has content"

      - name: Repository health summary
        if: success()
        run: |
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ğŸ‰ Repository Health Check: PASSED"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo ""
          echo "All checks completed successfully!"
          echo "Repository structure is valid."
          echo ""
          echo "For more information, see:"
          echo "  - WORKFLOW_STATUS.md (workflow documentation)"
          echo "  - KNOWLEDGE_BASE.md (project principles)"
          echo "  - Issue #4 (workflow improvements)"
          echo ""
          echo "Community contributions welcome! ğŸš€"
